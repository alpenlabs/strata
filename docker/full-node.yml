services:
  reth:
    build:
      context: ../
      dockerfile: ./docker/reth/Dockerfile
    image: "alpen_reth:v0.1.0"
    environment:
      CONFIG_FILE: ${CONFIG_FILE:-example_config.toml}
      BUILD_PROFILE: ${BUILD_PROFILE:-release}
      RETH_PORT: ${RETH_PORT:-12002}
      P2P_SECRET_KEY: ${P2P_RETH_SECRET_KEY:-8f2a559490d8e61f3fa578be89e65bdca1e5a48f7b840a5a5dbd71a7a21c22a9}
      RETH_AUTH_RPC_PORT: ${RETH_AUTH_RPC_PORT:-8551}
      JWTSECRET: ${JWTSECRET}
    volumes:
      - ./data/reth:/app/reth
      - ./configs:/app/configs
    ports:
      - "${RETH_AUTH_RPC_PORT:-8551}:${RETH_AUTH_RPC_PORT:-8551}"
      - "${RETH_PORT:-8545}:${RETH_PORT:-8545}"
    expose:
      - ${RETH_AUTH_RPC_PORT:-8551}
      - ${RETH_PORT:-8545}
    networks:
      - strata_network

  client:
    build:
      context: ../
      dockerfile: ./docker/strata-client/Dockerfile
    image: "strata_client:v0.2.0"
    environment:
      CONFIG_PATH: /app/configs/config.toml
      PARAM_PATH: /app/configs/params.json
      RUST_LOG: ${RUST_LOG:-debug}
    container_name: strata_client
    ports:
      - "8432:8432"
    volumes:
      - ./data/data-strata:/app/data
      - ./configs:/app/configs
    depends_on:
      - bitcoind
      - reth
    networks:
      - strata_network

  bitcoind:
    image: "public.ecr.aws/s6b4k6i9/strata/signet:latest"
    environment:
      MINERENABLED: 0
      ADDNODE: ${ADDNODE}
      SIGNETCHALLENGE: ${SIGNETCHALLENGE}
    container_name: strata_bitcoind
    volumes:
      - ./data/data-bitcoind:/root/.bitcoin/
    ports:
      - "38332:38332"
    expose:
      - ${BITCOIND_RPC_PORT:-9823}
    networks:
      - strata_network

networks:
  strata_network:
    driver: bridge
    name: strata_network
